!function(t){"use strict";t(document).ready((function(t){t(".wopb-compare-modal-content .wopb-loop-variations-form, .wopb-block-item .wopb-product-btn .wopb-loop-variations-form").remove(),t(document).on("wopbAjaxComplete",(function(){t(this).variationForm()})),t(this).variationForm()})),t.fn.variationForm=function(){t(".variations_form").each((function(){let a=t(this);if(a.hasClass("wopb-variation-init"))return;let e={form:a};if(!a.parents(".wopb-builder-cart:first").length){let i=a.parents(".single-product:first").find(".product:first"),r=a.parents(".product.product-type-variable:first:not([id])").not(".single-product"),o=a.parents(".wopb-block-content-wrap:first");if(r.length||o.length){let t=r,i="img:first",n=r.find(".wopb-variation-switcher-price"),s="thumb_src";o.length&&(t=o,i=".wopb-block-image a img:first",n=o.find(".wopb-product-price"),s="full_src"),e={...e,product:t,imgItem:i,switcherPrice:n,defaultPriceHtml:n.html(),srcSelector:"full_src",source:"loopProduct"},a.wopVariationSwitch(e)}else i.length&&setTimeout((function(){let t=i.find(".woocommerce-product-gallery .flex-control-nav .flex-active");e={...e,product:i,nav:i.find(".woocommerce-product-gallery .flex-control-nav"),defaultNav:t,activeSlide:".flex-active-slide",defaultProductImage:i.find(".woocommerce-product-gallery .flex-active-slide a img"),getImage:i.find(".woocommerce-product-gallery .woocommerce-product-gallery__image a img"),navItem:"li",source:"singleProduct"},a.wopVariationSwitch(e)}),100);t(this).wc_variation_form()}}))},t.fn.wopVariationSwitch=function(a={}){if(t(this).hasClass("wopb-variation-init"))return;t(this).addClass("wopb-variation-init");let{product:e,form:i,source:r=""}=a,o=e.find(".add_to_cart_button"),n=o.filter((function(){return!t(this).children().length})).first().text();e.backupProductImage(a),t(i).on("click",".wopb-variation-swatches .wopb-swatch",(function(s){s.preventDefault(e),e.parents(".wopb-block-item:first").find(".wopb-product-deals").remove();let c=t(this),l=c.closest(".value").find("select"),d=c.parents("tr:first").find(".label label:first"),f=`<span class="wopb-swatch-label-value">: ${c.data("name")}</span>`;d.find(".wopb-swatch-label-value").remove(),c.hasClass("disabled")||(l.trigger("focusin")&&!l.find('option[value="'+c.attr("data-value")+'"]').length?(c.siblings(".wopb-swatch").removeClass("selected"),l.val("")):c.hasClass("selected")?(l.val(""),c.removeClass("selected")):(c.addClass("selected").siblings(".selected").removeClass("selected"),l.val(c.attr("data-value")),d.append(f)),l.trigger("change")),setTimeout((function(){let s=e.find(".wopb-variation-swatches"),c=e.find(".wopb-swatch.selected"),l=c.parents(".wopb-variation-swatches:first").attr("data-attribute_name"),d=c.attr("data-variation_id");if(1==c.length)if(c.hasClass("wopb-swatch-color")||c.hasClass("wopb-swatch-image")){let t=JSON.parse(i.attr("data-product_variations")),r=!1;for(const i in t)if(!r&&t.hasOwnProperty(i)&&c.attr("data-value")===t[i].attributes[l]&&d==t[i].variation_id){r=!0;let o=t[i];e.changeVariationImage(o,a)}}else e.resetDefaultImage(a);else c.length<1&&i.find(".reset_variations").trigger("click");"singleProduct"!==r&&c.length!=s.length&&e.resetCartText(o,n),t(i).find("tbody tr").each((function(){let a=t(this),e=a.find("select option"),i=e.filter(":selected"),r=[];e.each((function(t,a){""!==a.value&&r.push(a.value)})),a.find(".wopb-swatch").each((function(){e=t(this).attr("data-value"),r.indexOf(e)>-1?(t(this).removeClass("disabled"),t(this).find(".wopb-variation-swatch-tooltip").show()):(t(this).addClass("disabled"),t(this).find(".wopb-variation-swatch-tooltip").hide(),i.length&&e===i.val()&&t(this).removeClass("selected"))}))}))}),100)})),"singleProduct"!==r&&t(i).on("found_variation",(function(i,r){if(r){let i=t(this),s=e.find(".wopb-variation-swatches"),c=e.find(".wopb-swatch.selected"),l={},d=i.find("select[name^=attribute]");return d=d.length?d:i.find("[name^=attribute]:checked"),d=d.length?d:i.find("input[name^=attribute]"),d.each((function(){let a=t(this),e=a.attr("name"),i=a.val();a.removeClass("error"),0===i.length?a.addClass("required error"):l[e]=i})),c.length==s.length&&(r.is_in_stock&&e.cartBtnText(o,r,l),a.defaultPriceHtml&&e.changeVariationPrice(r,a),r.wopb_deal&&e.showDeal(r)),r.is_in_stock||e.resetCartText(o,n),e.changeVariationImage(r,a),!0}})),t(i).on("click",".reset_variations",(function(i){i.preventDefault(),t(this).closest("table.variations").find(".wopb-swatch.selected").removeClass("selected"),t(this).closest("table.variations").find(".wopb-swatch.disabled").removeClass("disabled"),"singleProduct"!==r&&(t(".wopb-swatch-label-value").remove(),e.parents(".wopb-block-item:first").find(".wopb-product-deals").remove(),e.resetCartText(o,n),a.defaultPriceHtml&&e.resetVariationPrice(a)),e.resetDefaultImage(a)}))},t.fn.showDeal=function(a){let e=t(this);e.parents(".wopb-block-item:first").find(".wopb-product-new-meta").after(a.wopb_deal),e.parents(".wopb-block-item:first").find(".wopb-product-deals").each((function(t,a){loopcounter(a)})),e.parents(".wopb-block-item:first").find(".wopb-product-deals").css({opacity:1,transform:"translate(0,0)"})},t.fn.changeVariationImage=function(a,e){let{nav:i,defaultNav:r,navItem:o,defaultProductImage:n,activeSlide:s}=e,c=t(this).getProductImage(e);n||(n=c);let l={alt:a.image.alt,src:e.srcSelector?a.image[e.srcSelector]:a.image.full_src,srcset:n.attr("srcset")?a.image.srcset:"",sizes:a.image.sizes};if(i&&i.length&&i.find(o).length){let e=i.find('img[src="'+a.image.gallery_thumbnail_src+'"]');e=e.length?e:i.find('img[src="'+a.image.full_src+'"]'),e.length?(e.parents(`${o}:first`).trigger("click"),e.trigger("click")):(r.trigger("click"),a.image.full_src!==n.attr("src")&&n.attr(l));let c=t(this).find(`${s} .zoomImg`);if(c.length>0){let t={alt:a.image.alt,src:a.image.full_src,width:a.image.full_src_w,height:a.image.full_src_h};c.attr(t),setTimeout((function(){c.css("width",a.image.full_src_w+"px"),c.css("height",a.image.full_src_h+"px")}),200)}}else c.attr(l)},t.fn.resetDefaultImage=function(a){let{defaultNav:e,defaultProductImage:i}=a;i||(i=t(this).getProductImage(a));let r={alt:i.attr("data-backup_alt"),src:i.attr("data-backup_src"),srcset:i.attr("data-backup_srcset"),width:i.attr("data-backup_width"),height:i.attr("data-backup_height")};e&&e.length?(e.trigger("click"),i.attr("data-backup_src")!==i.attr("src")&&i.attr(r)):i.attr(r)},t.fn.backupProductImage=function(a){let e=t(this).getProductImage(a),i={"data-backup_alt":e.attr("alt"),"data-backup_src":e.attr("src"),"data-backup_srcset":e.attr("srcset"),"data-backup_width":e.attr("width"),"data-backup_height":e.attr("height")};e.attr(i)},t.fn.getProductImage=function(a={}){let{getImage:e,imgItem:i}=a,r="";return e?r=a.getImage:i&&(r=t(this).find(i)),r},t.fn.cartBtnText=function(a,e,i){a.each((function(){let a=t(this),r=a;if(a.parents(".wopb-cart-action:first").find(".wopb-cart-tooltip:first").length)r=a.parents(".wopb-cart-action:first").find(".wopb-cart-tooltip:first");else if(a.children().length)return;let o=a.data("add-to-cart-text");o||(o="Add To Cart"),a.attr("data-variation_id",e.variation_id),a.attr("data-variation",JSON.stringify(i)),r.text(o),a.addClass("wopb-loop-add-to-cart-button")}))},t.fn.resetCartText=function(a,e){a.each((function(){let a=t(this),i=a;if(a.parents(".wopb-cart-action:first").find(".wopb-cart-tooltip:first").length)i=a.parents(".wopb-cart-action:first").find(".wopb-cart-tooltip:first");else if(a.children().length)return;i.text(e),a.removeClass("wopb-loop-add-to-cart-button"),a.removeAttr("data-variation_id"),a.removeAttr("data-variation")}))},t.fn.changeVariationPrice=function(t,a){a.switcherPrice.html(""),t.price_html?a.switcherPrice.html(t.price_html):a.switcherPrice.html(a.defaultPriceHtml)},t.fn.resetVariationPrice=function(t){t.switcherPrice.html(""),t.switcherPrice.html(t.defaultPriceHtml)},t(document).on("click",".wopb-loop-add-to-cart-button",(function(a){a.preventDefault();let e=t(this),i=e.data("product_id"),r=e.attr("data-variation_id"),o=e.attr("data-variation");if(i=Math.abs(parseFloat(i).toFixed(0)),r=Math.abs(parseFloat(r).toFixed(0)),isNaN(i)||0===i||isNaN(r)||0===r)return!0;if(e.is(".wc-variation-is-unavailable"))return window.alert(wc_add_to_cart_variation_params.i18n_unavailable_text);""!==o&&(o=JSON.parse(o));let n={action:"wopb_variation_loop_add_cart",product_id:i,variation_id:r,variation:o};t(document.body).trigger("adding_to_cart",[e,n]),e.addClass("loading"),t.ajax({type:"POST",url:wopb_core.ajax_variation_loop_add_cart,data:n,dataType:"json",success:function(a){a&&(tb_remove(),a.error&&a.product_url?window.location=a.product_url:(t(document.body).trigger("added_to_cart",[a.fragments,a.cart_hash,e]),t(document.body).trigger("update_checkout"),"yes"!==wc_add_to_cart_params.cart_redirect_after_add?(e.removeClass("loading"),e.parents(".wopb-cart-action:first").addClass("wopb-active")):window.location=wc_add_to_cart_params.cart_url))},error:function(t){e.removeClass("loading")}})}))}(jQuery);
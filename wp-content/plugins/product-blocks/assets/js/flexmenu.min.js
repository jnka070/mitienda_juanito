!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}((function(e){function i(i){e("li.flexMenu-viewMore.active").not(i).removeClass("active").find("> ul").hide()}var n,l=e(window).width(),o=e(window).height(),t=[];e(window).resize((function(){clearTimeout(n),n=setTimeout((function(){(e(window).width()!==l||e(window).height()!==o)&&(e(t).each((function(){e(this).flexMenu({undo:!0}).flexMenu(this.options)})),l=e(window).width(),o=e(window).height())}),200)})),e.fn.flexMenu=function(n){var l,o=e.extend({threshold:2,cutoff:2,linkText:"More",linkTitle:"View More",linkTextAll:"Menu",linkTitleAll:"Open/Close Menu",shouldApply:function(){return!0},showOnHover:!0,popupAbsolute:!0,popupClass:"",undo:!1},n);return this.options=o,(l=e.inArray(this,t))>=0?t.splice(l,1):t.push(this),this.each((function(){function n(e){return Math.ceil(e.offset().top)>=M+w}var l,t,f,u,s,d,p=e(this),r=p.find("> li"),a=r.first(),h=r.last(),c=r.length,M=Math.floor(a.offset().top),w=Math.floor(a.outerHeight(!0)),v=!1;if(n(h)&&c>o.threshold&&!o.undo&&p.is(":visible")&&o.shouldApply()){var x=e('<ul class="flexMenu-popup" style="display:none;'+(o.popupAbsolute?" position: absolute;":"")+'"></ul>');for(x.addClass(o.popupClass),d=c;d>1;d--){if(t=n(l=p.find("> li:last-child")),d-1<=o.cutoff){e(p.children().get().reverse()).appendTo(x),v=!0;break}if(!t)break;l.appendTo(x)}v?p.append('<li class="flexMenu-viewMore flexMenu-allInPopup"><a href="#" title="'+o.linkTitleAll+'">'+o.linkTextAll+"</a></li>"):p.append('<li class="filter-item flexMenu-viewMore"><a href="#" title="'+o.linkTitle+'">'+o.linkText+"</a></li>"),n(f=p.find("> li.flexMenu-viewMore"))&&p.find("> li:nth-last-child(2)").appendTo(x),x.children().each((function(e,i){x.prepend(i)})),f.append(x),p.find("> li.flexMenu-viewMore > a").click((function(e){i(f),x.toggle(),f.toggleClass("active"),e.preventDefault()})),o.showOnHover&&"undefined"!=typeof Modernizr&&!Modernizr.touch&&f.hover((function(){x.show(),e(this).addClass("active")}),(function(){x.hide(),e(this).removeClass("active")}))}else if(o.undo&&p.find("ul.flexMenu-popup")){for(u=(s=p.find("ul.flexMenu-popup")).find("li").length,d=1;u>=d;d++)s.find("> li:first-child").appendTo(p);s.remove(),p.find("> li.flexMenu-viewMore").remove()}}))}}));